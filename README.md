# π§µ μ‚¬μ©μ ν¬μΈνΈ λ™μ‹μ„± μ μ–΄ μ„¤κ³„ λ³΄κ³ μ„

## π“ κ°μ”

μ΄ μ‹μ¤ν…μ€ μ‚¬μ©μλ³„ ν¬μΈνΈ μ¶©μ „ λ° μ‚¬μ© κΈ°λ¥μ„ μ κ³µν•λ©°, λ™μ‹μ— μ—¬λ¬ μ”μ²­μ΄ λ“¤μ–΄μ¬ κ²½μ° **λ°μ΄ν„° μ •ν•©μ„±**μ„ μ μ§€ν•κΈ° μ„ν•΄ **Key κΈ°λ° λ™κΈ°ν™” μ μ–΄**λ¥Ό λ„μ…ν–μµλ‹λ‹¤.
`SynchronizedLockTemplate`μ„ ν†µν•΄ μ‚¬μ©μ ID λ‹¨μ„λ΅ **synchronized λΈ”λ΅μ„ μ•μ „ν•κ² λν•‘**ν•κ³ , λ½ μ¶©λ/μ¬μ‹λ„/νƒ€μ„μ•„μ›ƒ μ²λ¦¬κΉμ§€ ν¬κ΄„μ μΌλ΅ κ΄€λ¦¬ν•©λ‹λ‹¤.

## π― λ™μ‹μ„± μ μ–΄μ ν•„μ”μ„±

- **κ³µμ  μμ› λ³΄νΈ**
  ν¬μΈνΈ μ •λ³΄λ” μ—¬λ¬ μ¤λ λ“μ—μ„ λ™μ‹μ— μ ‘κ·Ό λ° μμ •λ  μ μμµλ‹λ‹¤.
- **μΌκ΄€μ„± λ³΄μ¥**
  μ¶©μ „/μ‚¬μ©/μ΄λ ¥ κΈ°λ΅μ€ μ›μμ  μ‘μ—…μΌλ΅ μ²λ¦¬λμ–΄μ•Ό ν•©λ‹λ‹¤.
- **λ°μ΄ν„° μ†μ‹¤ λ°©μ§€**
  μ μ ν• λ½ μ²λ¦¬κ°€ μ—†λ‹¤λ©΄ Race ConditionμΌλ΅ μΈν•΄ ν¬μΈνΈκ°€ μ†μ‹¤λκ±°λ‚ κ³Όλ‹¤ μ°¨κ°λ  μ μμµλ‹λ‹¤.

## π§± κµ¬μ„± μ”μ†

### 1. `SynchronizedLockTemplate<K>`

- Key κΈ°λ° λ½ νλ“ λ° λ™κΈ°ν™” λΈ”λ΅ μ‹¤ν–‰ ν…ν”λ¦Ώ
- νƒ€μ„μ•„μ›ƒ, μ¬μ‹λ„, μΈν„°λ½νΈ, μμ™Έ λν•‘ μ²λ¦¬ ν¬ν•¨
- `synchronized(lock)`μ„ μ•μ „ν•κ² κ΄€λ¦¬

### 2. `PointLockManager<K>`

- Keyλ³„λ΅ λ½ κ°μ²΄ κ΄€λ¦¬
- `WeakReference`μ™€ `ReferenceQueue`λ¥Ό ν™μ©ν•΄ GC λ€μƒμ΄ λλ©΄ μλ™ μ •λ¦¬
- λ™μΌν• Keyμ— λ€ν•΄ λ™μΌν• λ½ κ°μ²΄ λ³΄μ¥

### 3. `SynchronizedBlock<T>`

- μ‹¤ν–‰ν•  μ‚¬μ©μ μ •μ λΈ”λ΅ (`() -> T`)
- λ½ νλ“ μ΄ν›„ μ‹¤ν–‰λλ” μ„κ³„ κµ¬μ—­

## π”„ λ™μ‘ νλ¦„

```plaintext
UserService
  β”β”€ chargePoint(userId, amount)
  β””β”€ usePoint(userId, amount)
        β”‚
        β–Ό
SynchronizedLockTemplate.executeWithLock(userId, block)
        β”‚
        β–Ό
PointLockManager.getLock(userId)
        β”‚
        β–Ό
synchronized(lock) {
    block.execute()  β† ν¬μΈνΈ κ³„μ‚° + μ €μ¥ + μ΄λ ¥κΈ°λ΅
}
```
